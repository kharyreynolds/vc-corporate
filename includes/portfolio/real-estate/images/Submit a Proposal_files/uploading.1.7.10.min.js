!function(){function a(a,b){window.XMLHttpRequest.prototype[a]=b(window.XMLHttpRequest.prototype[a])}function b(a,b,c){try{Object.defineProperty(a,b,{get:c})}catch(d){}}var c=function(){try{var a=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(a)return!0}catch(b){if(void 0!=navigator.mimeTypes["application/x-shockwave-flash"])return!0}return!1};if(window.XMLHttpRequest&&!window.FormData||window.FileAPI&&FileAPI.forceLoad){var d=function(a){if(!a.__listeners){a.upload||(a.upload={}),a.__listeners=[];var b=a.upload.addEventListener;a.upload.addEventListener=function(c,d,e){a.__listeners[c]=d,b&&b.apply(this,arguments)}}};a("open",function(a){return function(b,c,e){d(this),this.__url=c;try{a.apply(this,[b,c,e])}catch(f){f.message.indexOf("Access is denied")>-1&&a.apply(this,[b,"_fix_for_ie_crossdomain__",e])}}}),a("getResponseHeader",function(a){return function(b){return this.__fileApiXHR&&this.__fileApiXHR.getResponseHeader?this.__fileApiXHR.getResponseHeader(b):null==a?null:a.apply(this,[b])}}),a("getAllResponseHeaders",function(a){return function(){return this.__fileApiXHR&&this.__fileApiXHR.getAllResponseHeaders?this.__fileApiXHR.getAllResponseHeaders():null==a?null:a.apply(this)}}),a("abort",function(a){return function(){return this.__fileApiXHR&&this.__fileApiXHR.abort?this.__fileApiXHR.abort():null==a?null:a.apply(this)}}),a("setRequestHeader",function(a){return function(b,c){if("__setXHR_"===b){d(this);var e=c(this);e instanceof Function&&e(this)}else this.__requestHeaders=this.__requestHeaders||{},this.__requestHeaders[b]=c,a.apply(this,arguments)}}),a("send",function(a){return function(){var d=this;if(arguments[0]&&arguments[0].__isFileAPIShim){var e=arguments[0],f={url:d.__url,jsonp:!1,cache:!0,complete:function(a,c){d.__completed=!0,!a&&d.__listeners.load&&d.__listeners.load({type:"load",loaded:d.__loaded,total:d.__total,target:d,lengthComputable:!0}),!a&&d.__listeners.loadend&&d.__listeners.loadend({type:"loadend",loaded:d.__loaded,total:d.__total,target:d,lengthComputable:!0}),"abort"===a&&d.__listeners.abort&&d.__listeners.abort({type:"abort",loaded:d.__loaded,total:d.__total,target:d,lengthComputable:!0}),void 0!==c.status&&b(d,"status",function(){return 0==c.status&&a&&"abort"!==a?500:c.status}),void 0!==c.statusText&&b(d,"statusText",function(){return c.statusText}),b(d,"readyState",function(){return 4}),void 0!==c.response&&b(d,"response",function(){return c.response});var e=c.responseText||(a&&0==c.status&&"abort"!==a?a:void 0);b(d,"responseText",function(){return e}),b(d,"response",function(){return e}),a&&b(d,"err",function(){return a}),d.__fileApiXHR=c,d.onreadystatechange&&d.onreadystatechange(),d.onload&&d.onload()},fileprogress:function(a){if(a.target=d,d.__listeners.progress&&d.__listeners.progress(a),d.__total=a.total,d.__loaded=a.loaded,a.total===a.loaded){var b=this;setTimeout(function(){d.__completed||(d.getAllResponseHeaders=function(){},b.complete(null,{status:204,statusText:"No Content"}))},1e4)}},headers:d.__requestHeaders};f.data={},f.files={};for(var g=0;g<e.data.length;g++){var h=e.data[g];null!=h.val&&null!=h.val.name&&null!=h.val.size&&null!=h.val.type?f.files[h.key]=h.val:f.data[h.key]=h.val}setTimeout(function(){if(!c())throw'Adode Flash Player need to be installed. To check ahead use "FileAPI.hasFlash"';d.__fileApiXHR=FileAPI.upload(f)},1)}else a.apply(d,arguments)}}),window.XMLHttpRequest.__isFileAPIShim=!0;var e=function(a){if(!c())throw'Adode Flash Player need to be installed. To check ahead use "FileAPI.hasFlash"';var b=angular.element(a);if(!(b.attr("disabled")||b.hasClass("js-fileapi-wrapper")||null==b.attr("ng-file-select")&&null==b.attr("data-ng-file-select")&&null==b.attr("ng-file-generated-elem--")||(b.addClass("js-fileapi-wrapper"),null==b.attr("ng-file-generated-elem--")))){var d=angular.element(document.getElementById("e"+b.attr("id")));d.bind("mouseover",function(){""!==b.parent().css("position")&&"static"!==b.parent().css("position")||b.parent().css("position","relative"),b.css("position","absolute").css("top",d[0].offsetTop+"px").css("left",d[0].offsetLeft+"px").css("width",d[0].offsetWidth+"px").css("height",d[0].offsetHeight+"px").css("padding",d.css("padding")).css("margin",d.css("margin")).css("filter","alpha(opacity=0)"),d.attr("onclick",""),b.css("z-index","1000")})}},f=function(a){return function(b){for(var c=FileAPI.getFiles(b),d=0;d<c.length;d++)void 0===c[d].size&&(c[d].size=0),void 0===c[d].name&&(c[d].name="file"),void 0===c[d].type&&(c[d].type="undefined");b.target||(b.target={}),b.target.files=c,b.target.files!=c&&(b.__files_=c),(b.__files_||b.target.files).item=function(a){return(b.__files_||b.target.files)[a]||null},a&&a.apply(this,[b])}},g=function(a,b){return("change"===b.toLowerCase()||"onchange"===b.toLowerCase())&&"file"==a.getAttribute("type")};HTMLInputElement.prototype.addEventListener&&(HTMLInputElement.prototype.addEventListener=function(a){return function(b,c,d,h){g(this,b)?(e(this),a.apply(this,[b,f(c),d,h])):a.apply(this,[b,c,d,h])}}(HTMLInputElement.prototype.addEventListener)),HTMLInputElement.prototype.attachEvent&&(HTMLInputElement.prototype.attachEvent=function(a){return function(b,c){g(this,b)?(e(this),window.jQuery?angular.element(this).bind("change",f(null)):a.apply(this,[b,f(c)])):a.apply(this,[b,c])}}(HTMLInputElement.prototype.attachEvent)),window.FormData=FormData=function(){return{append:function(a,b,c){b.__isFileAPIBlobShim&&(b=b.data[0]),this.data.push({key:a,val:b,name:c})},data:[],__isFileAPIShim:!0}},window.Blob=Blob=function(a){return{data:a,__isFileAPIBlobShim:!0}},function(){if(window.FileAPI||(window.FileAPI={}),FileAPI.forceLoad&&(FileAPI.html5=!1),!FileAPI.upload){var a,b,d,e,f,g=document.createElement("script"),h=document.getElementsByTagName("script");if(window.FileAPI.jsUrl)a=window.FileAPI.jsUrl;else if(window.FileAPI.jsPath)b=window.FileAPI.jsPath;else for(d=0;d<h.length;d++)if(f=h[d].src,e=f.search(/\/angular\-file\-upload[\-a-zA-z0-9\.]*\.js/),e>-1){b=f.substring(0,e+1);break}null==FileAPI.staticPath&&(FileAPI.staticPath=b),g.setAttribute("src",a||b+"FileAPI.min.js"),document.getElementsByTagName("head")[0].appendChild(g),FileAPI.hasFlash=c()}}(),FileAPI.disableFileInput=function(a,b){b?a.removeClass("js-fileapi-wrapper"):a.addClass("js-fileapi-wrapper")}}window.FileReader||(window.FileReader=function(){var a=this,b=!1;this.listeners={},this.addEventListener=function(b,c){a.listeners[b]=a.listeners[b]||[],a.listeners[b].push(c)},this.removeEventListener=function(b,c){a.listeners[b]&&a.listeners[b].splice(a.listeners[b].indexOf(c),1)},this.dispatchEvent=function(b){var c=a.listeners[b.type];if(c)for(var d=0;d<c.length;d++)c[d].call(a,b)},this.onabort=this.onerror=this.onload=this.onloadstart=this.onloadend=this.onprogress=null;var c=function(b,c){var d={type:b,target:a,loaded:c.loaded,total:c.total,error:c.error};return null!=c.result&&(d.target.result=c.result),d},d=function(d){if(b||(b=!0,a.onloadstart&&this.onloadstart(c("loadstart",d))),"load"===d.type){a.onloadend&&a.onloadend(c("loadend",d));var e=c("load",d);a.onload&&a.onload(e),a.dispatchEvent(e)}else if("progress"===d.type){var e=c("progress",d);a.onprogress&&a.onprogress(e),a.dispatchEvent(e)}else{var e=c("error",d);a.onerror&&a.onerror(e),a.dispatchEvent(e)}};this.readAsArrayBuffer=function(a){FileAPI.readAsBinaryString(a,d)},this.readAsBinaryString=function(a){FileAPI.readAsBinaryString(a,d)},this.readAsDataURL=function(a){FileAPI.readAsDataURL(a,d)},this.readAsText=function(a){FileAPI.readAsText(a,d)}})}(),function(a){"use strict";var b=a.module("components.uploading.helpers.image",["ngImgCrop","components.core.utils"]);b.service("eoImageHelper",["$q","$rootScope","$document","cropEXIF","eoUtils",function(b,c,d,e,f){return{dataURItoBlob:function(b,c){for(var d=atob(b.split(",")[1]),e=[],f=d.length,g=0;g<f;g++)e.push(d.charCodeAt(g));var h=a.extend({},c);return new Blob([new window.Uint8Array(e)],h)},apllyRotationFromEXIF:function(b,c,f){function g(b,c,d,e,f){var g=[3,6,8].indexOf(d)>-1,h=[6,8].indexOf(d)>-1,i=b.getContext("2d"),j=0;switch(d){case 3:f.cx=-c.width,f.cy=-c.height,j=180;break;case 6:f.cw=c.height,f.ch=c.width,f.cy=-c.height,j=90;break;case 8:f.cw=c.height,f.ch=c.width,f.cx=-c.width,j=270}if(a.isDefined(e)&&(f.cw>f.ch?(e>f.cw&&(e=f.cw),i.scale(e/f.cw,e/f.cw),f.cx=e/f.cw*f.cx,f.cy=e/f.cw*f.cy,f.ch=e/f.cw*f.ch,f.cw=e):(e>f.ch&&(e=f.ch),i.scale(e/f.ch,e/f.ch),f.cx=e/f.ch*f.cx,f.cy=e/f.ch*f.cy,f.cw=e/f.ch*f.cw,f.ch=e)),b.width=f.cw,b.height=f.ch,g&&i.rotate(j*Math.PI/180),h){var k=f.ch;f.ch=f.cw,f.cw=k}}function h(a,b,c,e){var f=new Image,h=d[0].createElement("canvas"),i=h.getContext("2d");f.onload=function(){var a={cw:f.width,ch:f.height,cx:0,cy:0};g(h,f,c,void 0,a),i.drawImage(f,a.cx,a.cy);var b=h.toDataURL("image/png");g(h,f,c,226,a),i.drawImage(f,a.cx,a.cy,a.cw,a.ch);var d=h.toDataURL("image/png");e&&e(b,d,c)},f.src=b}e.getData(b,function(){var a=e.getTag(b,"Orientation");h(b,c,a,f)})},loadImageByUrl:function(a){var d=b.defer(),e=f.parseUrl(a),g=f.parseUrl(document.location.href),h=new Image;""===e.host||e.host===g.host&&e.protocol===g.protocol&&e.port===g.port||h.setAttribute("crossOrigin","anonymous"),h.onerror=function(a){d.reject(a)},h.onload=function(a){var b=document.createElement("canvas");b.width=this.width,b.height=this.height;var c=b.getContext("2d");c.drawImage(this,0,0);try{d.resolve(b.toDataURL("image/png"))}catch(e){d.reject(e)}};try{h.src=a,c.$evalAsync(function(){d.notify({})})}catch(i){d.reject(i)}return d.promise}}}])}(angular),function(){"use strict";var a=angular.module("components.uploading.helpers.models",["components.core.model"]);a.run(["eoModelRegistry",function(a){var b=a.get("Base"),c=a.get("Exception"),d=b.extend({name:"",file:null,progress:-1,response:null,init:function(a){"undefined"!=typeof a&&this._super(a)}});a.put("FileUpload",d);var e=b.extend({type:"",name:"",size:0,file_key:"",init:function(a){"undefined"!=typeof a&&this._super(a)}});a.put("WebStorageUpload",e),a.put("UploadTypeException",c.extend({}))}])}(),function(a){"use strict";var b=a.module("components.uploading.helpers",[]);b.config([function(){!window.XMLHttpRequest||window.FileAPI&&window.FileAPI.shouldLoad||(window.XMLHttpRequest.prototype.setRequestHeader=function(a){return function(b,c,d){if("__setXHR_"===b){var e=c(this);e instanceof Function&&e(this)}else a.apply(this,arguments)}}(window.XMLHttpRequest.prototype.setRequestHeader))}]),b.service("eoUpload",["$http","$q","$timeout",function(b,c,d){function e(a){a.method=a.method||"POST",a.headers=a.headers||{},a.transformRequest=a.transformRequest||function(a,c){return window.ArrayBuffer&&a instanceof window.ArrayBuffer?a:b.defaults.transformRequest[0](a,c)};var e=c.defer();!window.XMLHttpRequest||window.FileAPI&&window.FileAPI.shouldLoad||(a.headers.__setXHR_=function(){return function(b){b&&(a.__XHR=b,a.xhrFn&&a.xhrFn.constructor===Function&&a.xhrFn(b),b.upload.addEventListener("progress",function(a){e.notify(a)},!1),b.upload.addEventListener("load",function(a){a.lengthComputable&&e.notify(a)},!1))}}),b(a).then(function(a){e.resolve(a)},function(a){e.reject(a)},function(a){e.notify(a)});var f=e.promise;return f.success=function(b){return f.then(function(c){b(c.data,c.status,c.headers,a)}),f},f.progress=function(a){return f.then(null,null,function(b){a(b)}),f},f.error=function(b){return f.then(null,function(c){b(c.data,c.status,c.headers,a)}),f},f.abort=function(){return a.__XHR&&d(function(){a.__XHR.abort()}),f},f.xhr=function(b){return a.xhrFn=function(a){return function(){a&&a.apply(f,arguments),b.apply(f,arguments)}}(a.xhrFn),f},f.then=function(b,c){return function(d,e,f){a.progress=f||a.progress;var g=c.apply(b,[d,e,f]);return g.abort=b.abort,g.progress=b.progress,g.xhr=b.xhr,g.then=b.then,g}}(f,f.then),f}return{upload:function(c){c.headers=c.headers||{},c.headers["Content-Type"]=void 0,c.transformRequest=c.transformRequest||b.defaults.transformRequest;var d=new FormData,f=c.transformRequest,g=c.data;return c.transformRequest=function(b,d){if(g&&(c.formDataAppender?a.forEach(g,function(a,d){c.formDataAppender(b,d,a)}):a.forEach(g,function(c,e){if(a.isFunction(f))c=f(c,d);else for(var g=0;g<f.length;g++){var h=f[g];a.isFunction(h)&&(c=h(c,d))}b.append(e,c)})),null!==c.file){var e=c.fileFormDataName||"file";if(a.isArray(c.file))for(var h=a.isString(e),i=0;i<c.file.length;i++)b.append(h?e+i:e[i],c.file[i],c.file[i].name);else b.append(e,c.file,c.file.name)}return b},c.data=d,e(c)},http:function(a){return e(a)}}}]),b.directive("eoFileSelect",["$parse",function(a){return{restrict:"A",scope:{onSelect:"&eoFileSelect"},link:function(a,b,c){b.on("change",function(b){var c=[],d=b.target.files;null!==d&&Array.prototype.push.apply(c,d),a.$apply(function(){a.onSelect({$files:c,$event:b})})})}}}]),b.directive("eoFileDrop",["$parse",function(a){return{restrict:"A",scope:{onSelect:"&eoFileDrop"},link:function(a,b,c){window.FileReader&&(b.on("dragover",function(a){b.addClass("dragover"),a.stopPropagation(),a.preventDefault()}),b.on("dragleave",function(a){b.removeClass("dragover"),a.stopPropagation(),a.preventDefault()}),b.on("drop",function(c){b.removeClass("dragover"),c.stopPropagation(),c.preventDefault();var d=null;c.dataTransfer?d=c.dataTransfer.files:c.originalEvent&&c.originalEvent.dataTransfer&&(d=c.originalEvent.dataTransfer.files);var e=[];null!==d&&Array.prototype.push.apply(e,d),a.$apply(function(){a.onSelect({$event:c,$files:e})})}))}}}])}(angular),function(a){"use strict";var b=a.module("components.uploading.uploaders.file",["components.uploading.helpers","components.core.popover","components.core.modal","components.core.config","components.core.block","components.uploading.helpers.models"]);b.constant("DROPBOX_APP_KEY","lss047vujjt0bir"),b.constant("FILE_UPLOAD_URL","/api/files/v1/tmp.xhtml"),b.constant("DROPBOX_UPLOAD_URL","/api/files/v1/webstorage.json"),b.directive("eoFileUploadList",["eoUpload","eoConfig","$window","$http","eoModelFactory","eoBlockWatcher","DROPBOX_APP_KEY","eoModal","FILE_UPLOAD_URL","DROPBOX_UPLOAD_URL",function(b,c,d,e,f,g,h,i,j,k){var l=function(){if(!d.Dropbox){var a=document.createElement("script");a.type="text/javascript",a.id="dropboxjs",a.setAttribute("data-app-key",h),a.async=!1,a.src="https://www.dropbox.com/static/api/2/dropins.js",document.getElementsByTagName("head")[0].appendChild(a)}};return{restrict:"A",require:"?^form",scope:{onComplete:"&eoFileUploadList",preloadedFiles:"="},link:function(b,c,d,e){if(l(),b.closePopover=function(){setTimeout(function(){c.children().eq(1).triggerHandler("click")},0)},b.requestWatch=new g,e&&b.$watch("requestWatch.pending",function(a){e.$setValidity("uploadingFile",!a)}),b.preloadedFiles&&b.preloadedFiles.length>0){var h=[];a.forEach(b.preloadedFiles,function(a){var b=new File([""],a.name,a),c=f.get("FileUpload",{file:b,progress:100});h.push(c)}),b.onComplete({$files:h})}},controller:["$scope",function(g){var h=a.extend(c.get("env")||{},{USER_MAX_FILE_UPLOAD:26214400});g.selectedFiles=[],g.uploadedFiles=[],g.$watchCollection("uploadedFiles",function(a){a.length===g.selectedFiles.length&&g.onComplete({$files:a})});var l=function(b){return function(c){var d=null;if(c.constructor===String){var e=c.replace(/(<([^>]+)>)/gi,"");d=a.fromJson(e)}else d=c;g.selectedFiles[b].response=d,201===+d.code?(g.selectedFiles[b].progress=100,g.uploadedFiles.push(g.selectedFiles[b])):400===+d.code?(g.selectedFiles[b].error=d,i.simple({locals:{_header:"Empty attachment",_body:d.message}})):413===+d.code?(g.selectedFiles[b].error=d,i.simple({locals:{_header:"Attachment size limit exceeded",_body:d.message}})):500===+d.code&&(g.selectedFiles[b].error=d,i.simple({locals:{_header:"Internal Server Error",_body:d.message}}))}},m=function(a){return function(b){g.selectedFiles[a].error=b}};g.uploadFile=function(c){a.forEach(c,function(a){if(a.size<=h.USER_MAX_FILE_UPLOAD){var c=f.get("FileUpload",{file:a,progress:-1,dataUrl:null}),d=g.selectedFiles.push(c)-1;g.requestWatch.wait(b.upload({url:j,file:a,fileFormDataName:"attachment"}).success(l(d)).progress(function(a){g.selectedFiles[d].progress=parseInt(100*a.loaded/a.total)}).error(m(d)))}else i.simple({locals:{_header:"Too big",_body:"Your file is too big"}})}),g.closePopover()},g.chooseFromDropbox=function(){d.Dropbox.choose({success:function(b){g.$apply(function(){a.forEach(b,function(a){if(a.bytes<=h.USER_MAX_FILE_UPLOAD){var b=f.get("FileUpload",{file:a,progress:-1,dataUrl:null}),c=g.selectedFiles.push(b)-1,d=f.get("WebStorageUpload",{type:"dropbox",name:a.name,size:a.bytes,file_key:a.link});g.requestWatch.wait(e({method:"POST",url:k,data:d.toFormData(),headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(l(c)).error(m(c)))}else i.simple({locals:{_header:"Too big",_body:"Your file is too big"}})})})},linkType:"direct",multiselect:!0}),g.closePopover()},g.removeSelectedFile=function(a){g.selectedFiles.splice(a,1)}}],templateUrl:"FileUploadList.tmpl.html"}}])}(angular),function(a){"use strict";var b=a.module("components.uploading.uploaders.imageDrop",["components.uploading.helpers","components.core.block","components.uploading.helpers.image"]);b.constant("IMAGEDROP_UPLOAD_URL","/upload"),b.constant("IMAGE_ACCEPTED_TYPES",{"image/png":!0,"image/jpeg":!0,"image/gif":!0}),b.directive("eoImageDrop",["$parse","$compile","$window","eoUpload","eoImageHelper","IMAGEDROP_UPLOAD_URL","IMAGE_ACCEPTED_TYPES",function(b,c,d,e,f,g,h){return{restrict:"A",templateUrl:"ImageDrop.tmpl.html",require:"?^ngModel",transclude:!0,scope:{onSelect:"&eoImageDrop",onUpload:"&eoImageDropOnUpload",onError:"&eoImageDropOnError",onProgress:"&eoImageDropOnProgress"},link:function(b,c,i,j){function k(a,c){var d=function(d){b.onUpload({$file:a,$result:d}),c.status="success",c.result=d,o(b.files)},f=function(d){b.onError({$file:a,$result:d}),c.status="error",c.result=d,o(b.files)};e.upload({url:g,file:a,data:{}}).then(d,f)}function l(a,c){if("undefined"!==d.FileReader&&p[a.type]===!0){var e=new FileReader;e.addEventListener("load",function(d){var e=d.target.result,g={preview:n,original:n,status:"loading",file:a};b.files.push(g),o(b.files),b.$apply();var h=b.files.length-1;f.apllyRotationFromEXIF(a,e,function(a,d,e){b.files[h].preview=d,b.files[h].file=f.dataURItoBlob(g.original),o(b.files),b.$apply(),c&&c(g)})}),e.readAsDataURL(a)}}function m(c,d){a.forEach(c,function(a){l(a,function(b){k(a,b)})}),b.onSelect({$event:event,$files:c}),d!==!1&&b.$apply()}var n="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";b.files=[];var o=function(a){b.files=a,j?j.$setViewValue(b.files):b.$$phase&&b.$apply()},p=h||{},q=function(){var a=document.createElement("div");return"draggable"in a||"ondragstart"in a&&"ondrop"in a};c.addClass("eo-image-drop");var r=c.find("input"),s=c;i.eoUploadLink&&(s=a.element(c[0].querySelector(i.eoUploadLink))),s.on("click",function(){r[0].click()}),b.removeFile=function(a){b.files.splice(a,1),o(b.files)},b.fileSelected=function(a){m(a,!1)},d.FileReader&&q&&(c.on("dragover",function(a){c.addClass("dragover"),a.stopPropagation(),a.preventDefault()}),c.on("dragleave",function(a){c.removeClass("dragover"),a.stopPropagation(),a.preventDefault()}),c.on("drop",function(a){c.removeClass("dragover"),a.stopPropagation(),a.preventDefault();var b=null;a.dataTransfer?b=a.dataTransfer.files:a.originalEvent&&a.originalEvent.dataTransfer&&(b=a.originalEvent.dataTransfer.files),m(b)}))}}}]),b.directive("eoImageDropPreview",["$parse","eoUpload","IMAGEDROP_UPLOAD_URL",function(a,b,c){return{restrict:"A",scope:!0,link:function(b,c,d){var e=a(d.eoImageDropPreview),f=e(b);f.id="eo-image-drop-preview-"+b.$id,e.assign(b,f),c.addClass("eo-image-drop-preview"),c.attr("id","eo-image-drop-preview-"+b.$id)}}}])}(angular),function(a){"use strict";var b=a.module("components.uploading.uploaders.profileImage",["components.uploading.helpers","components.files.images.crop","components.uploading.helpers.image","components.core.model","components.core.block"]);b.constant("PROFILE_IMAGE_AREA_TYPE","circle"),b.constant("PROFILE_IMAGE_UPLOAD_URL","/upload"),b.constant("PROFILE_IMAGE_TYPE_REGEXP",/^image\/(png|gif|jpeg)$/),b.constant("PROFILE_IMAGE_ACCEPT","image/png,image/gif,image/jpeg"),b.service("eoTemplateImageService",[function(){var a={};this.set=function(b,c){a[b]=c},this.get=function(b){return a[b]}}]),b.config(["$provide","PROFILE_IMAGE_CROP_TOOL_COLORS",function(a,b){a.decorator("cropCanvas",["$delegate","eoTemplateImageService",function(a,c){var d=c.get("profile_image_outline"),e=function(c){return a.call(this,c),this.drawCropArea=function(a,d,e,f,g){var h=Math.floor(e*f[1]/f[0]),i=a.width/c.canvas.width,j=a.height/c.canvas.height,k=d[0]-e/2,l=d[1]-h/2;if(c.save(),c.setLineDash([5]),c.strokeStyle=b.areaOutline,c.lineWidth=2,c.beginPath(),g(c,d,e,h),c.stroke(),c.clip(),e>0){var m=k*i,n=l*j,o=e*i,p=h*j;c.drawImage(a,m,n,o,p,k,l,e,h),this.setCropCoord(m,n,o,p)}c.beginPath(),g(c,d,e,h),c.stroke(),c.clip(),c.restore(),this.drawGuide(c,d,e,h)},this.drawGuide=function(a,b,c,e){if(d){var f=c>e?e:c,g=b[0]-c/2,h=b[1]-e/2;a.save(),a.globalAlpha=.8,a.drawImage(d,g,h,f,f),a.restore()}},this.drawIconResizeCircle=function(a,d,e){c.save(),c.strokeStyle=b.resizeCircleStroke,c.lineWidth=1,c.fillStyle=b.resizeCircleFill,c.beginPath(),c.fillRect(a[0]-d/2,a[1]-d/2,d,d),c.strokeRect(a[0]-d/2,a[1]-d/2,d,d),c.fill(),c.stroke(),c.closePath(),c.restore()},this};return e}])}]),b.directive("eoProfileImageUploader",["eoUpload","PROFILE_IMAGE_AREA_TYPE","PROFILE_IMAGE_UPLOAD_URL","PROFILE_IMAGE_TYPE_REGEXP","eoImageHelper","eoModelRegistry","eoBlockWatcher","eoImageCropCoord","eoTemplateImageService",function(b,c,d,e,f,g,h,i,j){return{templateUrl:"ProfileImageUploader.tmpl.html",scope:{onCancel:"&",onSuccess:"&",onError:"&",onProgress:"&",onSaveImage:"&",returnOriginalImage:"@",imageUrl:"=?",uploadUrl:"=?",uploadUnchangedImage:"@",areaType:"@",resultImageAspect:"@"},link:function(b,c,d){b.uploadNewImage=function(){b.dataImg.isFileSelected=!1,b.dataImg.orig=null,a.element(c).find("input").val(null)};var e=c[0].querySelector(".profile_image_outline");e&&j.set("profile_image_outline",e)},controller:["$scope","PROFILE_IMAGE_ACCEPT","PROFILE_IMAGE_AREA_TYPE",function(c,j,k){var l="false"!==c.returnOriginalImage,m="true"===c.uploadUnchangedImage,n=g.get("UploadTypeException");c.imageAccept=j,c.isFileChanged=!1,c.watcher=new h,c.areaType=c.areaType||k,c.dataImg={file:null,orig:"",cropped:"",isFileSelected:!1,isFileChanged:!1},c.$watch("imageUrl",function(a,b){a&&c.watcher.wait(f.loadImageByUrl(a).then(function(b){c.dataImg.file=f.dataURItoBlob(b),c.dataImg.file.name=a.substring(a.lastIndexOf("/")+1),c.dataImg.isFileSelected=!0,c.dataImg.orig=b},function(a){c.onError({result:a})},function(a){c.onProgress({event:a})}))}),c.onFileSelect=function(a,b){var d=a[0];if(d){if(!e.test(d.type))return void c.onError({result:new n({message:"Only images can be selected"})});c.dataImg.file=d,c.dataImg.isFileSelected=!0;var f=new FileReader;f.onload=function(a){c.dataImg.isFileChanged=!0,c.$apply(function(b){b.dataImg.orig=a.target.result})},f.onprogress=function(a){c.onProgress({event:a})},f.readAsDataURL(d)}},c.getFileSelectionStatus=function(){return c.dataImg.isFileSelected},c.cancel=function(){c.onCancel()},c.uploadImage=function(){var e;c.dataImg.isFileChanged&&(e=f.dataURItoBlob(c.dataImg.cropped,{type:c.dataImg.file.type}),e.name=c.dataImg.file.name),c.onSaveImage(),b.upload({url:c.uploadUrl?c.uploadUrl:d,file:c.dataImg.isFileChanged||m?l?c.dataImg.file:e:null,data:{cropCoord:a.toJson(i.get())}}).then(function(a){c.dataImg.isFileChanged=!1,c.onSuccess({result:a})},function(a){c.onError({result:a})},function(a){c.onProgress({event:a})})}}]}}])}(angular),function(){angular.module("components.uploading.uploaders",["components.uploading.uploaders.file","components.uploading.uploaders.profileImage"])}();